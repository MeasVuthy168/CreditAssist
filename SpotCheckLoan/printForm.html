
<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <title>Credit Spot Check Form</title>
  <style>
    @font-face {
  font-family: 'Krasar';
  src: url('../Krasar-Regular.ttf') format('truetype');
}

/* Base Styles */
body {
  font-family: 'Krasar', Arial, sans-serif;
  margin: 0;
  padding: 20px;
  font-size: 12px;
}

/* Containers */
.header-container {
  border: 2px solid transparent;
  padding: 5px;
  margin: 0 auto;
  max-width: 850px;
  box-sizing: border-box;
}

.page-container {
  border: 2px solid black;
  padding: 5px;
  margin: 0 auto;
  max-width: 850px;
  box-sizing: border-box;
}

/* Header Layout */
.header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  font-size: 12px;
}

.header-left {
  font-weight: bold;
  font-size: 13px;
  margin-top: 12px;
}

.print-button-container {
  margin-top: 8px;
}

.header-center {
  text-align: center;
  flex: 1;
  font-weight: bold;
  font-size: 14px;
}

.header-right {
  text-align: right;
  font-weight: bold;
  font-size: 14px;
}

.header-right img {
  width: 130px;
}

.short-divider {
  width: 80px;
  height: 3px;
  background-color: black;
  margin: 6px auto;
}

.decor-line {
  text-align: center;
  font-family: monospace;
  margin-top: 4px;
}

/* Section Titles */
.form-section {
  border: 2px solid black;
  padding: 5px 0 5px 14px;
  background: #e0e0e0;
  font-weight: bold;
  margin-top: 20px;
  font-size: 12px;
}

.subsection-title {
  font-weight: bold;
  margin-top: 10px;
  font-size: 12px;
  margin-left: 16px;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 6px;
  table-layout: auto;
}

td {
  border: 1px solid #333;
  padding: 6px 10px;
  vertical-align: top;
}

.checkbox {
  margin-right: 8px;
}

/* Signature Block */
.signature-section {
  margin-top: 20px;
  text-align: right;
  font-size: 14px;
  font-weight: bold;
  line-height: 1.6;
}

/* Buttons */
.print-button {
  padding: 8px 20px;
  font-size: 14px;
  font-weight: bold;
  background-color: #0d2d5c;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

@media print {
  .print-button {
    display: none;
  }
}
</style>

<head>
  <meta charset="UTF-8">
  <title>Credit Spot Check Form</title>
  <link rel="stylesheet" href="credit-spot-check.css"> <!-- Link to external CSS -->
</head>
<body>

  <div class="header-container">
    <div class="header">
      <div class="header-left">
        សាខាខេត្តស្វាយរៀង
        <div class="print-button-container">
          <button class="print-button" onclick="window.print()">បោះពុម្ព (Print Form)</button>
        </div>
      </div>
      <div class="header-center">
        ព្រះរាជាណាចក្រកម្ពុជា<br>
        ជាតិ សាសនា ព្រះមហាក្សត្រ<br>
        <div class="short-divider"></div>
        ត្រួតពិនិត្យកិច្ចការឥណទាន<br>
        (Credit Spot Check)<br>
        <div class="decor-line">~~~*~~~</div>
      </div>
      <div class="header-right">
        <img src="../icons/LogoAC2.PNG" alt="ACLEDA Logo">
        <div>ត្រួតពិនិត្យវដ្ត: <input type="text" value="01" style="width: 40px;"></div>
      </div>
    </div>
  </div>

  <div class="page-container">

<!-- Section I -->
<div class="form-section">I. ព័ត៌មានឥណទាន (Credit Information)</div>

<!-- Subsection ក -->
<div class="subsection-title">ក - ព័ត៌មានអតិថិជន</div>
<table>
  <tr>
    <td>ឈ្មោះអតិថិជន:</td><td id="customerName"></td>
    <td>លេខអតិថិជន:</td><td id="customerID"></td>
    <td>ទំហំឥណទាន:</td><td id="loanSize"></td>
  </tr>
  <tr>
    <td>សមតុល្យឥណទាន:</td><td id="osUSD"></td>
    <td>អត្រាការប្រាក់:</td><td id="rate"></td>
    <td>រូបិយប័ណ្ណ:</td><td id="ccy"></td>
  </tr>
  <tr>
    <td>ថ្ងៃបញ្ចេញឥណទាន:</td><td id="disburse"></td>
    <td>ថ្ងៃបញ្ចប់ឥណទាន:</td><td id="maturity"></td>
    <td>រយៈពេល:</td><td id="loanTerm"></td>
  </tr>
  <tr>
    <td>វដ្តខ្ចីប្រាក់:</td><td id="loanCycle"></td>
    <td>ឈ្មោះសាខា:</td><td id="branchOK"></td>
    <td>ប្រភេទឥណទាន:</td><td id="productType"></td>
  </tr>
</table>

<!-- Subsection ខ -->
<div class="subsection-title">ខ - ស្ថានភាពបង់ប្រាក់</div>
<table>
  <colgroup><col style="width: 180px;"><col></colgroup>
  <tr><td>ស្ថានភាព:</td><td id="repaymentStatus"></td></tr>
  <tr><td>មូលហេតុ:</td><td id="repaymentNote"></td></tr>
</table>

<!-- Subsection គ -->
<div class="subsection-title">គ - ឯកសារឥណទាន</div>
<table>
  <colgroup><col style="width: 180px;"><col></colgroup>
  <tr><td>ស្ថានភាពឯកសារ:</td><td id="docStatus"></td></tr>
  <tr><td>មូលហេតុ:</td><td id="docNote"></td></tr>
</table>

<!-- Section II -->
<div class="form-section">II. ការចុះត្រួតពិនិត្យផ្ទាល់ (Physical Inspection on site visit)</div>

<!-- Subsection ក -->
<div class="subsection-title">ក - ព័ត៌មានមុខរបរ</div>
<table>
  <colgroup><col style="width: 180px;"><col></colgroup>
  <tr><td>មុខរបរពេលខ្ចី:</td><td id="businessOld"></td></tr>
  <tr><td>មុខរបរបច្ចុប្បន្ន:</td><td id="businessNow"></td></tr>
  <tr><td>ស្ថានភាពជំនួញ:</td><td id="businessStatus"></td></tr>
  <tr><td>បញ្ជាក់បន្ថែម:</td><td id="businessNote"></td></tr>
</table>

<!-- Subsection ខ -->
<div class="subsection-title">ខ - ព័ត៌មានទ្រព្យធានា</div>
<table>
  <colgroup><col style="width: 180px;"><col></colgroup>
  <tr><td>ប្រភេទទ្រព្យ:</td><td id="collateralType"></td></tr>
  <tr><td>ស្ថានភាពទ្រព្យ:</td><td id="collateralStatus"></td></tr>
  <tr><td>តម្លៃទ្រព្យធានា:</td><td id="collateralValue"></td></tr>
  <tr><td>*មូលហេតុ:</td><td id="collateralNote"></td></tr>
</table>

<!-- Subsection គ -->
<div class="subsection-title">គ - សញ្ញាណហានិភ័យ</div>
<table>
  <colgroup><col style="width: 180px;"><col></colgroup>
  <tr><td>គោលបំណងប្រើប្រាស់ប្រាក់កម្ចី:</td><td id="usagePurpose"></td></tr>
  <tr><td>*បញ្ជាក់បន្ថែម:</td><td id="usageNote"></td></tr>
  <tr><td>ប្រភពសំណង:</td><td id="repaymentSource"></td></tr>
  <tr><td>បញ្ជាក់បន្ថែម:</td><td id="sourceNote"></td></tr>
</table>

<!-- Subsection ឃ -->
<div class="subsection-title">ឃ - សន្និដ្ឋាន</div>
<table>
  <colgroup><col style="width: 180px;"><col></colgroup>
  <tr><td>សន្និដ្ឋាន:</td><td id="conclusion"></td></tr>
</table>

<!-- Signature Section -->
<div class="signature-section">
  <div id="checkDate"></div>
  អ្នកចុះត្រួតពិនិត្យ<br>
  ហត្ថលេខា<br><br>......................
</div>
 
</div>
  
<script>
async function fetchSpotCheckData(cif) {
  try {
    const response = await fetch(`/api/spotcheck/report?cif=${cif}`);
    const data = await response.json();
    if (data) {
      fillSpotCheckData(data);
    } else {
      alert('No SpotCheck data found');
    }
  } catch (error) {
    console.error('Error fetching SpotCheck data:', error);
    alert('Failed to load data');
  }
}

function fillSpotCheckData(data) {
  const mapping = {
    customerID: data.LD_CUSTOMER_ID,
    customerName: data.NAME_KHMER,
    loanSize: data.LOAN_SIZE,
    osUSD: data.OS_USD,
    rate: data.RATE,
    ccy: data.CCY,
    disburse: data.DISBURSE,
    maturity: data.MATURITY,
    loanTerm: data.LOAN_TERM,
    loanCycle: data.LOAN_CYCLE,
    branchOK: data.BranchOK,
    productType: data.ProductType,
    repaymentStatus: data.repaymentStatus,
    repaymentNote: data.repaymentNote,
    docStatus: data.docStatus,
    docNote: data.docNote,
    businessOld: data.businessOld,
    businessNow: data.businessNow,
    businessStatus: data.businessStatus,
    businessNote: data.businessNote,
    collateralType: data.collateralType,
    collateralStatus: data.collateralStatus,
    collateralValue: data.collateralValue,
    collateralNote: data.collateralNote,
    usagePurpose: data.usagePurpose,
    usageNote: data.usageNote,
    repaymentSource: data.repaymentSource,
    sourceNote: data.sourceNote,
    conclusion: data.conclusion,
    checkDate: data.checkDate
  };

  for (const [id, value] of Object.entries(mapping)) {
    const element = document.getElementById(id);
    if (element) {
      element.innerText = value;
    }
  }
}

function prepareAndPrint() {
  const cif = prompt('Enter CIF to load SpotCheck Data:');
  if (cif) {
    fetchSpotCheckData(cif).then(() => {
      setTimeout(() => window.print(), 300); // delay to ensure data is filled
    });
  }
}
</script>
</body>
</html>
